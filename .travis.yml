os: linux

dist: xenial

language: python

python:
  - 3.6
  - 3.7
  - 3.8

#these directories are persistent
cache: pip

#https://github.com/conda/conda/blob/master/docs/source/user-guide/tasks/use-conda-with-travis-ci.rst
before_install:
  - sudo apt-get update
  # We do this conditionally because it saves us some downloading if the
  # version is the same.
  - wget https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh -O miniconda.sh;
  - bash miniconda.sh -b -p $HOME/miniconda
  - export PATH="$HOME/miniconda/bin:$PATH"
  - hash -r
  - conda config --set always_yes yes --set changeps1 no
  - conda config --append channels conda-forge
  - conda update -q conda
  # Useful for debugging any issues with conda
  - conda info -a

  - conda create -q -n test-environment python=$TRAVIS_PYTHON_VERSION numpy scipy opt_einsum sparse tqdm
  - source activate test-environment

jobs:
  include:
    - name: "Bare"
      install:
        - conda install -q pytest>=4.6 pytest-cov codecov
        - pip install .
    - name: "Plotting & fancy progressbar"
      install:
        - conda install -q pytest>=4.6 pytest-cov codecov requests matplotlib
        - pip install .
    - name: "Complete"
      install:
        - conda install -q pytest>=4.6 pytest-cov codecov requests matplotlib qutip jupyter nbsphinx numpydoc sphinx sphinx_rtd_theme
        - pip install .

script: pytest

after_success:
  - codecov

notifications:
  email: false

deploy:
  provider: pypi
  distributions: "sdist bdist_wheel"
  edge: true                            # use travis deployment v2
  on:
    tags: true                          # only deploy tagged commits
  skip_existing: true                   # upload artifacts only once
  username: "__token__"
  password:
    secure: "IGpk0C5hrt3CA6jddAyzGUC5S/EQMFsORNdktE/O9L/kgOlryIxH8eo1AICH8quc1d4bqVrnKmeM5c9RJ1j6GIkvQ84RYF67Tcnd4Ik3fHwYEth9ccbeD8e9WRrP8tCKR3Ex6QU7oUrXKH6UdoovTd2QlxRzkfLjzUgnGGO5avcmWZmEcq+Gq3JO1Wn7o1HEoJUFiRkW2pRBrpkl5ou0YV4zrFesdq9+AvCCl62wWdq9o6R38BWaQCdAd8gWDncTJ6eolNGMapq+7rnz6HCGdadx302w9eTfc3dnPlvI3EEpOlNFcDksiPMud6q5DxVaKbt+uv75uNkD+ZXVWHvQBTqE+cxJjTgfiL2p0K0U1RtWFCQq4CXRlsGEDy+YDGcyoqLa+sTG+9qR9GMUvwIdTeWfZQLx/lKFZHsHPfGGjE1Jj7rpJTVsDrQVNFmSzpuGJYfWjGc4X4GToRpPqPanL6UBhi3PjOWl+gQ1p8uqKzy7BEKX1deVx41K/qHCEDV2JFm373VG4I/u+EfPSSwar2VWjwzPUUI9uAJyVf0Ml7N9SRerHJ+8AXvLgQAQGwMTJrswMhyrQhMgkx8wyCegoAY1J8FvcA9XH+W8t9SQSrjMj16/+H06Krx3BIdk4/u9LQ4ezOldAAGSxTuqxFkOxdqyu9Fm2GLJxvss4J2SnTs="
